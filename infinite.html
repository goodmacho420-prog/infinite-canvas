<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:black;
  overflow:hidden;
}
canvas{
  position:fixed;
  top:0;
  left:0;
}
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");
c.width = innerWidth;
c.height = innerHeight;

let scale = 1;
let ox = 0;
let oy = 0;

let paths = [];
let drawing = false;
let current = [];

function world(x,y){
  return {
    x:(x-ox)/scale,
    y:(y-oy)/scale
  };
}

function redraw(){
  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,c.width,c.height);
  ctx.setTransform(scale,0,0,scale,ox,oy);

  ctx.strokeStyle="white";
  for(const path of paths){
    ctx.beginPath();
    ctx.moveTo(path[0].x,path[0].y);
    for(const p of path){
      ctx.lineTo(p.x,p.y);
    }
    ctx.stroke();
  }
}

c.addEventListener("mousedown",e=>{
  drawing=true;
  current=[world(e.clientX,e.clientY)];
  paths.push(current);
});

c.addEventListener("mousemove",e=>{
  if(!drawing) return;
  current.push(world(e.clientX,e.clientY));
  redraw();
});

addEventListener("mouseup",()=>drawing=false);

// ✅ Macで確実に効くズーム
c.addEventListener("wheel",e=>{
  e.preventDefault();
  const zoom = e.deltaY < 0 ? 1.2 : 0.8;
  const mx = e.offsetX;
  const my = e.offsetY;

  ox = mx - (mx-ox)*zoom;
  oy = my - (my-oy)*zoom;
  scale *= zoom;

  redraw();
},{passive:false});

redraw();
</script>

</body>
</html>